@model List<EmployeeVM>
@{
    ViewData["Title"] = "Employee List";
}

<link href="~/assets/css/emp.css" rel="stylesheet" />
<link href="~/assets/css/popup.css" rel="stylesheet" />

<style>
    .employee-list-container {
        padding: 10px;
        background: #f8f9fa;
        margin-top:-10px;
    }


    .list-header {
        background: linear-gradient(135deg,whitesmoke 0%,bisque 100%);
        color: white;
        padding: 15px 20px;
        border-radius: 10px 10px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 60px;
        margin-top: 0;
    }

        .list-header h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
        }

    .add-btn {
        background: white;
        color: #667eea;
        padding: 8px 18px;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 600;
        transition: all 0.3s;
        font-size: 14px;
    }

        .add-btn:hover {
            background: #f3f4f6;
            transform: translateY(-2px);
        }

    .filters-section {
        background: white;
        padding: 15px 20px;
        border-radius: 0 0 10px 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 10px;
    }

    .table-container {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* Fixed height table with scroll */
    .table-wrapper {
        max-height: calc(100vh - 350px); /* Adjust based on your header/filter height */
        overflow-y: auto;
        overflow-x: auto;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
    }

    /* Sticky table header */
    .modern-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
    }

        .modern-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }

            .modern-table thead th {
                background: #f8f9fa;
                padding: 10px 12px;
                font-weight: 600;
                text-align: left;
                border-bottom: 2px solid #dee2e6;
                font-size: 12px;
                color: #495057;
                white-space: nowrap;
            }

        .modern-table tbody td {
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 12px;
        }

        .modern-table tbody tr:hover {
            background-color: #f8f9fa;
        }

    .emp-photo {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #e5e7eb;
    }

    .action-btns {
        display: flex;
        gap: 4px;
    }

    .btn-action {
        width: 30px;
        height: 30px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .btn-view {
        background: #dbeafe;
        color: #1e40af;
    }

        .btn-view:hover {
            background: #bfdbfe;
        }

    .btn-edit {
        background: #fef3c7;
        color: #92400e;
    }

        .btn-edit:hover {
            background: #fde68a;
        }

    .btn-delete {
        background: #fee2e2;
        color: #991b1b;
    }

        .btn-delete:hover {
            background: #fecaca;
        }

    .pagination-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid #e5e7eb;
    }

    .pagination {
        display: flex;
        gap: 5px;
        list-style: none;
        margin: 0;
        padding: 0;
    }

    .page-item {
        display: inline-block;
    }

    .page-link {
        padding: 6px 10px;
        border: 1px solid #e5e7eb;
        background: white;
        color: #374151;
        text-decoration: none;
        border-radius: 6px;
        font-size: 12px;
        cursor: pointer;
    }

    .page-item.active .page-link {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }

    .page-item.disabled .page-link {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .no-data {
        text-align: center;
        padding: 40px;
        color: #9ca3af;
    }

    .modal-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .info-table {
        width: 100%;
        margin-bottom: 20px;
    }

        .info-table th {
            width: 40%;
            padding: 8px;
            text-align: left;
            font-weight: 600;
            color: #4b5563;
        }

        .info-table td {
            padding: 8px;
            color: #6b7280;
        }

    .section-heading {
        font-size: 16px;
        font-weight: 700;
        color: #667eea;
        margin-top: 20px;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid #667eea;
    }

    /* Custom Scrollbar */
    .table-wrapper::-webkit-scrollbar {
        width: 8px;
        height: 8px;
    }

    .table-wrapper::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
    }

    .table-wrapper::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
    }

        .table-wrapper::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
</style>

<div class="employee-list-container">
    <div class="list-header">
        <div>
            <h2>👥 Employee List</h2>
            <p style="margin: 5px 0 0 0; font-size: 12px; opacity: 0.9; color: blue;">Manage your organization's workforce</p>
        </div>
        <a href="@Url.Action("SaveEmployee", "Home")" class="add-btn">
            <i class="fas fa-plus me-1"></i> Add New Employee
        </a>
    </div>

    <div class="filters-section">
        <div class="row g-3">
            <div class="col-md-4">
                <input type="text" class="form-control form-control-sm" id="searchInput" placeholder="🔍 Search by name, code, phone...">
            </div>
            <div class="col-md-3">
                <select class="form-select form-select-sm" id="filterDepartment">
                    <option value="">All Departments</option>
                    @if (ViewBag.DepartmentList != null)
                    {
                        foreach (var dept in ViewBag.DepartmentList as IEnumerable<SelectListItem>)
                        {
                            <option value="@dept.Text">@dept.Text</option>
                        }
                    }
                </select>
            </div>
            <div class="col-md-3">
                <select class="form-select form-select-sm" id="filterStatus">
                    <option value="">All Status</option>
                    <option value="Active">Active</option>
                    <option value="Inactive">Inactive</option>
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-secondary btn-sm w-100" id="btnClearFilter">
                    <i class="fas fa-times me-1"></i> Clear
                </button>
            </div>
        </div>
    </div>

    <div class="table-container">
        <div class="table-wrapper">
            <table class="modern-table" id="employeeTable">
                <thead>
                    <tr>
                        <th>Photo</th>
                        <th>Branch</th>
                        <th>Emp Code</th>
                        <th>Name</th>
                        <th>Department</th>
                        <th>Designation</th>
                        <th>Phone</th>
                        
                        <th>Emp.Type</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="employeeTableBody">
                    @if (Model != null && Model.Any())
                    {
                        foreach (var emp in Model)
                        {
                            var photoUrl = string.IsNullOrEmpty(emp.Emp_Img) ? "/assets/img/user-placeholder.png" : $"/uploads/employee/{emp.Emp_Img}";

                            <tr class="employee-row"

                                data-name="@emp.Name?.ToLower()"
                                data-code="@emp.Emp_Code?.ToLower()"
                                data-phone="@emp.PhoneNo"
                                data-email="@emp.EmailId?.ToLower()"
                                data-department="@emp.Department"
                                data-status="@emp.Status">
                                <td><img src="@photoUrl" class="emp-photo" alt="Photo" onerror="this.src='/assets/img/user-placeholder.png'"></td>
                                <td>@emp.BranchName</td>
                                <td><strong>@emp.Emp_Code</strong></td>
                                <td>@emp.Name</td>
                                <td>@emp.Department</td>
                                <td>@emp.Designation</td>
                                <td>@emp.PhoneNo</td>
                                <td>@emp.EmployeeType</td>
                                <td>
                                    <div class="action-btns">
                                        <a href="@Url.Action("SaveEmployee", "Home", new { id = emp.Emp_Id })" class="btn-action btn-edit" title="Edit">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <form asp-action="DeleteEmployee" method="post" style="display:inline">
                                            <input type="hidden" name="empCode" value="@emp.Emp_Code" />
                                            <button class="btn btn-sm btn-danger"
                                                    onclick="return confirm('Do you really want to delete this record?')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>

                                    </div>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="9" class="no-data">
                                <i class="fas fa-users fa-3x mb-3" style="color: #d1d5db;"></i>
                                <p>No employees found</p>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div class="pagination-section">
            <div>
                <span id="recordInfo" style="font-size: 12px; color: #6b7280;">Showing 0 to 0 of 0 entries</span>
            </div>
            <nav>
                <ul class="pagination" id="pagination"></ul>
            </nav>
        </div>
    </div>
</div>

<!-- View Details Modal -->
<div class="modal fade" id="viewModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-user me-2"></i>Employee Details</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="employeeDetails">
                <!-- Details will be loaded here -->
            </div>
        </div>
    </div>
</div>

@if (TempData["Msg"] != null)
{
    var type = TempData["Type"] ?? "success"; // success / error
                                              <div class="popup-overlay @type" id="centerPopup">
                                                  <div class="popup-box">
                                                      <div class="popup-icon @type">
                                                          @(type == "success" ? "✓" : "✕")
                                                      </div>

            <h4>@(type == "success" ? "Success" : "Failed")</h4>
            <p>@TempData["Msg"]</p>
        </div>
    </div>
}


@section Scripts {
    <script>

                   const popup = document.getElementById("centerPopup");
        if (popup) {
         setTimeout(() => {
          popup.style.opacity = "0";
          setTimeout(() => popup.remove(), 300);
         }, 1500);
        }

        let allRows = [];
        let currentPage = 1;
        let rowsPerPage = 50; // Show all rows, no pagination needed with scrolling

        $(document).ready(function () {
            allRows = Array.from(document.querySelectorAll('.employee-row'));
            updateDisplay();

            $('#searchInput').on('keyup', filterTable);
            $('#filterDepartment').on('change', filterTable);
            $('#filterStatus').on('change', filterTable);
            $('#btnClearFilter').on('click', function () {
                $('#searchInput').val('');
                $('#filterDepartment').val('');
                $('#filterStatus').val('');
                filterTable();
            });
        });

        function filterTable() {
            const searchTerm = $('#searchInput').val().toLowerCase();
            const deptFilter = $('#filterDepartment').val();
            const statusFilter = $('#filterStatus').val();

            let visibleCount = 0;

            allRows.forEach(row => {
                const name = row.dataset.name || '';
                const code = row.dataset.code || '';
                const phone = row.dataset.phone || '';
                const email = row.dataset.email || '';
                const department = row.dataset.department || '';
                const status = row.dataset.status || '';

                const matchesSearch = name.includes(searchTerm) ||
                    code.includes(searchTerm) ||
                    phone.includes(searchTerm) ||
                    email.includes(searchTerm);

                const matchesDept = !deptFilter || department === deptFilter;
                const matchesStatus = !statusFilter || status === statusFilter;

                if (matchesSearch && matchesDept && matchesStatus) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });

            updateRecordInfo(visibleCount);
        }

        function updateDisplay() {
            const visibleRows = allRows.filter(row => row.style.display !== 'none');
            updateRecordInfo(visibleRows.length);
        }

        function updateRecordInfo(total) {
            if (total === 0) {
                $('#recordInfo').text('No entries found');
            } else {
                $('#recordInfo').text(`Showing ${total} ${total === 1 ? 'entry' : 'entries'}`);
            }
        }
    </script>
}