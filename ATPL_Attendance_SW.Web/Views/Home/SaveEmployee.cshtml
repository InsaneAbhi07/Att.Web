@model EmployeeVM
@{
    ViewData["Title"] = Model.Emp_Id == 0 ? "Add Employee" : "Edit Employee";
}
<link href="~/assets/css/emp.css" rel="stylesheet" />

<div class="employee-form-container">
    <form asp-action="SaveEmployee"
          asp-controller="Home"
          method="post"
          enctype="multipart/form-data"
          id="employeeForm">
        <input type="hidden" asp-for="Emp_Id" />

        <!-- Header -->
        <div class="form-header">
            <div>
                <h2 style="font-weight: 700;">@ViewData["Title"]</h2>
                <p>Complete all required fields to @(Model.Emp_Id == 0 ? "add a new" : "update") employee record</p>
            </div>
            <div>
                <a href="@Url.Action("EmployeeList1", "Home")" class="btn btn-outline-primary" style="margin-right: 10px;">
                    <i class="fas fa-list me-1"></i> View Employee List
                </a>
            </div>
        </div>

        <!-- Tabs -->
        <ul class="nav modern-tabs" id="empTabs" role="tablist">
            <li class="nav-item">
                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tabPersonal" type="button">
                    👤 Personal Info
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabContact" type="button">
                    📞 Contact & Employment
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabSalary" type="button">
                    💰 Salary Structure
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tabBank" type="button">
                    🏦 Bank & Documents
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- PERSONAL INFO TAB -->
            <div class="tab-pane fade show active" id="tabPersonal">
                <div class="row">
                    <div class="col-lg-3">
                        <div class="image-upload-section">
                            <img id="imgPreview" class="profile-image-preview"
                                 src="@(string.IsNullOrEmpty(Model.Emp_Img) ? "/assets/img/user-placeholder.png" : "/uploads/employee/" + Model.Emp_Img)"
                                 alt="Employee Photo" />
                            <div class="upload-btn-wrapper">
                                <button class="upload-btn" type="button">
                                    📸 Upload Photo
                                </button>
                                <input type="file" name="EmpImage" accept="image/*" onchange="previewImage(this)" />
                            </div>
                            <p style="margin-top: 8px; font-size: 10px; color: #6b7280;">Max 2MB, JPG/PNG (Optional)</p>
                        </div>
                    </div>

                    <div class="col-lg-9">
                        <div class="section-card">
                            <div class="section-title" style="font-weight: 700;">Basic Information</div>
                            <div class="row">

                                <div class="col-md-3 mb-2">
                                    <label class="form-label">Emp Code <span class="text-danger">*</span></label>

                                    <input asp-for="Emp_Code"
                                           type="text"
                                           class="form-control"
                                           id="Emp_Code"
                                           required
                                           onblur="checkEmpCode()" />

                                    <small id="empCodeMsg" class="text-danger" style="font-size:11px;"></small>
                                </div>



                                <div class="col-md-6 mb-2">
                                    <label class="form-label">Full Name <span class="text-danger">*</span></label>
                                    <input asp-for="Name" class="form-control" placeholder="Enter full name" required />
                                    <span class="text-danger" style="font-size: 11px;"></span>
                                </div>

                                <div class="col-md-3 mb-2">
                                    <label class="form-label">Date of Birth <span class="text-danger">*</span></label>
                                    <input asp-for="DOB" type="date" class="form-control" required />
                                    <span class="text-danger" style="font-size: 11px;"></span>
                                </div>


                                <div class="col-md-6 mb-2">
                                    <label class="form-label">Employment Type <span class="text-danger">*</span></label>

                                    <div class="radio-group">
                                        @foreach (var item in ViewBag.EmployeeType as List<SelectListItem>)
                                        {
                                            <label class="radio-option">
                                                <input type="radio"
                                                       name="EmpTypeId"
                                                       value="@item.Value"
                                                       @(Model != null && Model.EmpTypeId.ToString() == item.Value ? "checked" : "")
                                                       required />
                                                <span>@item.Text</span>
                                            </label>
                                        }
                                    </div>

                                    <span class="text-danger" style="font-size: 11px;"></span>
                                </div>




                        @*         <div class="col-md-6 mb-2">
                                    <label class="form-label">Employment Type <span class="text-danger">*</span></label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" asp-for="EmpType" value="Permanent" required />
                                            <span>Permanent</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" asp-for="EmpType" value="Contract" />
                                            <span>Contract</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" asp-for="EmpType" value="Intern" />
                                            <span>Intern</span>
                                        </label>
                                    </div>
                                    <span class="text-danger" style="font-size: 11px;"></span>
                                </div> *@

                                <div class="col-md-6 mb-2">
                                    <label class="form-label">Gender <span class="text-danger">*</span></label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" asp-for="Gender" value="Male" required />
                                            <span>Male</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" asp-for="Gender" value="Female" />
                                            <span>Female</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" asp-for="Gender" value="Transgender" required />
                                            <span>Transgender</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" asp-for="Gender" value="Other" />
                                            <span>Other</span>
                                        </label>
                                    </div>
                                    <span class="text-danger" style="font-size: 11px;"></span>
                                </div>

                                <div class="col-md-6 mb-2">
                                    <label class="form-label">Marital Status</label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" asp-for="MaritalStatus" value="Single" />
                                            <span>Single</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" asp-for="MaritalStatus" value="Married" />
                                            <span>Married</span>
                                        </label>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-2">
                                    <label class="form-label">Status <span class="text-danger">*</span></label>
                                    <div class="radio-group">
                                        <label class="radio-option">
                                            <input type="radio" asp-for="Status" value="Active" required checked />
                                            <span>Active</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" asp-for="Status" value="Inactive" />
                                            <span>Inactive</span>
                                        </label>
                                    </div>
                                    <span class="text-danger" style="font-size: 11px;"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons for Tab 1 -->
                <div class="form-actions">
                    <div class="nav-buttons">
                        <button type="button" class="btn-nav" id="btnPrevious1" onclick="previousTab()" disabled>
                            ← Previous
                        </button>
                        <button type="button" class="btn-nav" id="btnNext1" onclick="nextTab()">
                            Next →
                        </button>
                    </div>
                </div>
            </div>

            <!-- CONTACT & EMPLOYMENT TAB -->
            <div class="tab-pane fade" id="tabContact">
                <div class="section-card">
                    <div class="section-title" style="font-weight: 700;">Contact Information</div>
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <label class="form-label">Phone Number <span class="text-danger">*</span></label>
                            <input asp-for="PhoneNo" class="form-control" placeholder="+91 XXXXX XXXXX" required maxlength="10" pattern="[0-9]{10}" />
                            <span class="text-danger" style="font-size: 11px;"></span>
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Emergency Contact</label>
                            <input asp-for="EmergencyContact" class="form-control" placeholder="+91 XXXXX XXXXX" maxlength="10" pattern="[0-9]{10}" />
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Email Address <span class="text-danger">*</span></label>
                            <input asp-for="EmailId" type="email" class="form-control" placeholder="email@example.com" required />
                            <span class="text-danger" style="font-size: 11px;"></span>
                        </div>

                        <div class="col-12 mb-2">
                            <label class="form-label">Full Address</label>
                            <textarea asp-for="Address" class="form-control" rows="3" placeholder="Enter complete address"></textarea>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-title" style="font-weight: 700;">Employment Details</div>
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Department <span class="text-danger">*</span></label>
                            <select asp-for="DepartmentId" asp-items="ViewBag.DepartmentList" class="form-select" required>
                                <option value="">Select Department</option>
                            </select>
                            <span class="text-danger" style="font-size: 11px;"></span>
                        </div>

                        <div class="col-md-3 mb-2">
                            <label class="form-label">Designation <span class="text-danger">*</span></label>
                            <select asp-for="DesignationId" asp-items="ViewBag.DesignationList" class="form-select" required>
                                <option value="">Select Designation</option>
                            </select>
                            <span class="text-danger" style="font-size: 11px;"></span>
                        </div>

                        <div class="col-md-3 mb-2">
                            <label class="form-label">Work Shift <span class="text-danger">*</span></label>
                            <select asp-for="ShiftId" asp-items="ViewBag.Shiftlistt" class="form-select" required>
                                <option value="">Select Shift</option>
                            </select>
                            <span class="text-danger" style="font-size: 11px;"></span>
                        </div>

                        <div class="col-md-3 mb-2">
                            <label class="form-label">Work Under</label>
                            <select asp-for="WorkUnderId" asp-items="ViewBag.WorkUnderList" class="form-select">
                                <option value="0">Select Manager</option>
                            </select>
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Joining Date <span class="text-danger">*</span></label>
                            <input asp-for="JoiningDate" type="date" class="form-control" required />
                            <span class="text-danger" style="font-size: 11px;"></span>
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Resign Date</label>
                            <input asp-for="ResignDate" type="date" class="form-control" />
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons for Tab 2 -->
                <div class="form-actions">
                    <div class="nav-buttons">
                        <button type="button" class="btn-nav" onclick="previousTab()">
                            ← Previous
                        </button>
                        <button type="button" class="btn-nav" onclick="nextTab()">
                            Next →
                        </button>
                    </div>
                </div>
            </div>

            <!-- SALARY TAB -->
            <div class="tab-pane fade" id="tabSalary">
                <div class="section-card">
                    <div class="section-title" style="font-weight: 700;">Salary Components</div>
                    <div class="row">
                        <div class="col-md-4 mb-2">
                            <label class="form-label">Basic Salary <span class="text-danger">*</span></label>
                            <input asp-for="BasicSalary" type="number" step="0.01" class="form-control salary" placeholder="0.00" required min="0" />
                            <span class="text-danger" style="font-size: 11px;"></span>
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">House Rent Allowance (HRA)</label>
                            <input asp-for="HRA" type="number" step="0.01" class="form-control salary" placeholder="0.00" min="0" value="0" />
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Dearness Allowance (DA)</label>
                            <input asp-for="DA" type="number" step="0.01" class="form-control salary" placeholder="0.00" min="0" value="0" />
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Performance Allowance (PA)</label>
                            <input asp-for="PA" type="number" step="0.01" class="form-control salary" placeholder="0.00" min="0" value="0" />
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Other Allowances</label>
                            <input asp-for="OtherAllowance" type="number" step="0.01" class="form-control salary" placeholder="0.00" min="0" value="0" />
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Gross Salary</label>
                            <input asp-for="GrossSalary" type="number" step="0.01" class="form-control" readonly style="font-weight: 700; font-size: 14px; color: #10b981;" />
                        </div>

                    </div>

                    <div class="salary-summary">
                        <h4>Total Gross Salary</h4>
                        <p class="amount">₹ <span id="grossDisplay">0.00</span></p>
                    </div>
                </div>

                <!-- Navigation Buttons for Tab 3 -->
                <div class="form-actions">
                    <div class="nav-buttons">
                        <button type="button" class="btn-nav" onclick="previousTab()">
                            ← Previous
                        </button>
                        <button type="button" class="btn-nav" onclick="nextTab()">
                            Next →
                        </button>
                    </div>
                </div>
            </div>

            <!-- BANK & DOCUMENTS TAB -->
            <div class="tab-pane fade" id="tabBank">
                <div class="section-card">
                    <div class="section-title" style="font-weight: 700;">Bank Account Details</div>
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <label class="form-label">Bank Name</label>
                            <input asp-for="BankName" class="form-control" placeholder="e.g., State Bank of India" />
                        </div>

                        <div class="col-md-3 mb-2">
                            <label class="form-label">Account Holder Name</label>
                            <input asp-for="Ac_HolderName" class="form-control" placeholder="Enter account holder name" />
                        </div>

                        <div class="col-md-3 mb-2">
                            <label class="form-label">Account Number</label>
                            <input asp-for="Acc_No" class="form-control" placeholder="Enter account number" />
                        </div>

                        <div class="col-md-3 mb-2">
                            <label class="form-label">IFSC Code</label>
                            <input asp-for="IFSC_Code" class="form-control" placeholder="e.g., SBIN0001234" style="text-transform: uppercase;" />
                        </div>
                    </div>

                    <div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; border-radius: 6px; margin-top: 12px;">
                        <p style="margin: 0; color: #92400e; font-size: 11px; font-weight: 500;">
                            ⚠️ <strong>Note:</strong> Bank details are optional but recommended for salary processing.
                        </p>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-title" style="font-weight: 700;">Documents Upload (Optional)</div>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label class="form-label">Resume / CV</label>
                            <input type="file" name="ResumeDocument" class="form-control" accept=".pdf,.doc,.docx" />
                            <small class="text-muted">Accepted formats: PDF, DOC, DOCX (Max 5MB)</small>
                        </div>

                        <div class="col-md-6 mb-2">
                            <label class="form-label">Aadhar Card</label>
                            <input type="file" name="AadharDocument" class="form-control" accept=".pdf,.jpg,.jpeg,.png" />
                            <small class="text-muted">Accepted formats: PDF, JPG, PNG (Max 2MB)</small>
                        </div>
                    </div>
                </div>

                <div class="section-card">
                    <div class="section-title" style="font-weight: 700;">User Credentials (Optional)</div>
                    <div class="row">
                        
                        <div class="col-md-4 mb-2">
                            <label class="form-label">User Name <span class="text-danger">*</span></label>

                            <input asp-for="UserName"
                                   type="text"
                                   class="form-control"
                                   id="UserName"
                                   required
                                   onblur="checkUserName()" />

                            <small id="UserNameMsg" class="text-danger" style="font-size:11px;"></small>
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Password</label>
                            <input asp-for="Password" type="password" class="form-control" placeholder="Enter password" />
                        </div>

                        <div class="col-md-4 mb-2">
                            <label class="form-label">Role</label>
                            <select asp-for="Role" class="form-select">
                                <option value="">Select Role</option>
                                <option value="Admin">Admin</option>
                                <option value="Manager">Manager</option>
                                <option value="Employee">Employee</option>
                                <option value="HR">HR</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons - Only on Last Tab -->
                <div class="form-actions">
                    <div class="nav-buttons">
                        <button type="button" class="btn-nav" onclick="previousTab()">
                            ← Previous
                        </button>
                    </div>
                    <div class="submit-buttons">
                        <a href="@Url.Action("EmployeeList1", "Home")" class="btn-secondary-custom">
                            <i class="fas fa-times me-1"></i> Cancel
                        </a>
                        <button type="submit" class="btn-primary-custom">
                            <i class="fas fa-save me-1"></i> @(Model.Emp_Id == 0 ? "Create Employee" : "Update Employee")
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<style>
    .form-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }
</style>

<script>
    // Tab navigation
    const tabs = ['#tabPersonal', '#tabContact', '#tabSalary', '#tabBank'];
    let currentTabIndex = 0;

    function nextTab() {
        // Validate current tab before moving to next
        if (!validateCurrentTab()) {
            return;
        }

        if (currentTabIndex < tabs.length - 1) {
            currentTabIndex++;
            const nextTabElement = document.querySelector(`[data-bs-target="${tabs[currentTabIndex]}"]`);
            const bootstrapTab = new bootstrap.Tab(nextTabElement);
            bootstrapTab.show();
        }
    }

    function previousTab() {
        if (currentTabIndex > 0) {
            currentTabIndex--;
            const prevTabElement = document.querySelector(`[data-bs-target="${tabs[currentTabIndex]}"]`);
            const bootstrapTab = new bootstrap.Tab(prevTabElement);
            bootstrapTab.show();
        }
    }

    function validateCurrentTab() {
        const currentTab = document.querySelector(tabs[currentTabIndex]);
        const requiredFields = currentTab.querySelectorAll('[required]');
        let isValid = true;
        let errorMessages = [];

        requiredFields.forEach(field => {
            const label = field.closest('.mb-2')?.querySelector('.form-label')?.textContent.replace('*', '').trim();

            if (field.type === 'radio') {
                const radioGroup = field.name;
                const isChecked = currentTab.querySelector(`input[name="${radioGroup}"]:checked`);
                if (!isChecked) {
                    isValid = false;
                    errorMessages.push(label || field.name);
                    // Highlight radio group
                    const radioContainer = field.closest('.radio-group');
                    if (radioContainer) {
                        radioContainer.style.border = '1px solid #ef4444';
                        radioContainer.style.borderRadius = '6px';
                        radioContainer.style.padding = '5px';
                    }
                } else {
                    const radioContainer = field.closest('.radio-group');
                    if (radioContainer) {
                        radioContainer.style.border = 'none';
                        radioContainer.style.padding = '0';
                    }
                }
            } else {
                if (!field.value.trim() || (field.tagName === 'SELECT' && field.value === '')) {
                    isValid = false;
                    field.style.borderColor = '#ef4444';
                    errorMessages.push(label || 'A required field');
                } else {
                    field.style.borderColor = '#e5e7eb';
                }
            }
        });

        if (!isValid) {
            let message = 'Please fill the following required fields:\n\n';
            errorMessages.forEach(msg => {
                message += '• ' + msg + '\n';
            });
            alert(message);
        }

        return isValid;
    }

    // Update current tab index when tabs are clicked
    document.querySelectorAll('[data-bs-toggle="tab"]').forEach((tab, index) => {
        tab.addEventListener('shown.bs.tab', function () {
            currentTabIndex = index;
            localStorage.setItem('activeTab', this.getAttribute('data-bs-target'));
        });
    });

    // Image preview
    function previewImage(input) {
        if (input.files && input.files[0]) {
            const file = input.files[0];

            // Validate file size (2MB)
            if (file.size > 2 * 1024 * 1024) {
                alert('Image size must be less than 2MB');
                input.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('imgPreview').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    // Salary calculation
    document.querySelectorAll('.salary').forEach(input => {
        input.addEventListener('input', calculateGross);
    });

    function calculateGross() {
        let total = 0;
        document.querySelectorAll('.salary').forEach(input => {
            const value = parseFloat(input.value) || 0;
            total += value;
        });

        document.querySelector('[name="GrossSalary"]').value = total.toFixed(2);
        document.getElementById('grossDisplay').textContent = total.toLocaleString('en-IN', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    // Initialize on page load
    calculateGross();

    // Form validation on submit
 


    // Restore last active tab
    window.addEventListener('load', function () {
        const activeTab = localStorage.getItem('activeTab');
        if (activeTab) {
            const tab = document.querySelector(`[data-bs-target="${activeTab}"]`);
            if (tab) {
                const bootstrapTab = new bootstrap.Tab(tab);
                bootstrapTab.show();
                currentTabIndex = tabs.indexOf(activeTab);
            }
        }
    });

    // Remove red border on input
    document.querySelectorAll('input, select, textarea').forEach(field => {
        field.addEventListener('input', function() {
            this.style.borderColor = '#e5e7eb';
        });
        field.addEventListener('change', function() {
            this.style.borderColor = '#e5e7eb';
        });
    });
</script>
<script>
    // ... existing code ...

    // Department change event - Filter Designations
    document.querySelector('[name="DepartmentId"]').addEventListener('change', function() {
        const departmentId = this.value;
        const designationDropdown = document.querySelector('[name="DesignationId"]');

        // Clear current options
        designationDropdown.innerHTML = '<option value="">Select Designation</option>';

        if (departmentId) {
            // Fetch designations for selected department
            fetch('@Url.Action("GetDesignationsByDepartment", "Home")?departmentId=' + departmentId)
                .then(response => response.json())
                .then(data => {
                    data.forEach(item => {
                        const option = document.createElement('option');
                        option.value = item.value;
                        option.text = item.text;
                        designationDropdown.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Error fetching designations:', error);
                    alert('Error loading designations. Please try again.');
                });
        }
    });
</script>
<script>
    let empCodeValid = true;

    function checkEmpCode() {

        const empCode = document.getElementById("Emp_Code").value.trim();
        const empId = document.getElementById("Emp_Id")?.value || 0;
        const msg = document.getElementById("empCodeMsg");

        if (empCode.length < 2) {
            msg.innerText = "";
            return;
        }

        fetch(`/Home/CheckEmpCode?empCode=${empCode}&empId=${empId}`)
            .then(r => r.json())
            .then(exists => {

                if (exists) {
                    msg.innerText = "Employee code already exists";
                    msg.classList.remove("text-success");
                    msg.classList.add("text-danger");
                    empCodeValid = false;

                    document.getElementById("Emp_Code").focus();
                }
                else {
                    msg.innerText = "Employee code available";
                    msg.classList.remove("text-danger");
                    msg.classList.add("text-success");
                    empCodeValid = true;
                }
            });
    }
 
</script>

<script>
    let UserNameValid = true;

    function checkUserName() {

        const username = document.getElementById("UserName").value.trim();
        const empId = document.getElementById("Emp_Id")?.value || 0;
        const msg = document.getElementById("UserNameMsg");

        if (username.length < 2) {
            msg.innerText = "";
            return;
        }

        fetch(`/Home/CheckUsername?username=${username}&empId=${empId}`)
            .then(r => r.json())
            .then(exists => {

                if (exists) {
                    msg.innerText = "User Name code already exists";
                    msg.classList.remove("text-success");
                    msg.classList.add("text-danger");
                    UserNameValid = false;

                    document.getElementById("UserName").focus();
                }
                else {
                    msg.innerText = "User Name available";
                    msg.classList.remove("text-danger");
                    msg.classList.add("text-success");
                    UserNameValid = true;
                }
            });
    }

        document.getElementById('employeeForm').addEventListener('submit', function (e) {

        if (!empCodeValid) {
            e.preventDefault();
            alert("Please fix Employee Code before saving");
            return;
        }

        if (!UserNameValid) {
            e.preventDefault();
            alert("Please fix User Name before saving");
            return;
        }

        // validate tabs
        let allValid = true;
        let invalidTabs = [];

        for (let i = 0; i < tabs.length; i++) {
            currentTabIndex = i;
            if (!validateCurrentTab()) {
                allValid = false;
                invalidTabs.push(i + 1);
            }
        }

        if (!allValid) {
            e.preventDefault();
            alert('Please complete required fields in Tab(s): ' + invalidTabs.join(', '));
            return;
        }
    });

</script>
