@using System.Security.Claims
@model List<EmployeeVM>
@{
	ViewData["Title"] = "Admin Dashboard";
	Layout = "_Layout";
}

<style>
	/* .body{
	font-family:'Californian FB'
	} */
	.filter-area {
		background: rgba(255,255,255,0.15);
		padding: 6px;
		border-radius: 8px;
	}

	.filter-select {
		min-width: 220px;
	}

	.filter-select-sm {
		min-width: 140px;
	}

	.employee-table thead th{
		background-color:#f8fafc;
		font-weight:600;
		border-bottom: 2px solid #e5e7eb;
	}

	.employee-table tbody tr{
		transition : all 0.2s ease;
	}

	.employee-table tbody tr:hover{
		background-color:#f1f5f9;
	}

	.employee-table td{
		vertical-align: middle;	
	}
	/* Glass Dashboard Cards */
	.glass-card {
		background: rgba(255, 255, 255, 0.75);
		backdrop-filter: blur(12px);
		-webkit-backdrop-filter: blur(12px);
		border: 1px solid rgba(255, 255, 255, 0.3);
		border-radius: 16px;
		box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
		transition: all 0.3s ease;
	}

		.glass-card:hover {
			transform: translateY(-6px) scale(1.01);
			box-shadow: 0 16px 40px rgba(0, 0, 0, 0.12);
		}

		/* Card content polish */
		.glass-card h6 {
			font-weight: 600;
			color: #555;
			margin-bottom: 4px;
		}

		.glass-card h3 {
			font-weight: 700;
			font-family:'Californian FB'
			margin: 0;
		}

		/* Icon avatar smooth look */
		.glass-card .avatar {
			width: 42px;
			height: 42px;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			border-radius: 12px;
			color: #fff;
			box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
		}

	/* Glass Effect */
	.glass-card {
		background: rgba(255, 255, 255, 0.75);
		backdrop-filter: blur(14px);
		-webkit-backdrop-filter: blur(14px);
		border-radius: 18px;
		border: 1px solid rgba(255,255,255,0.3);
		box-shadow: 0 10px 30px rgba(0,0,0,0.08);
		transition: all 0.3s ease;
	}

		.glass-card:hover {
			transform: translateY(-4px);
		}

	/* Birthday list */
	.birthday-item {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 10px 12px;
		border-radius: 12px;
		background: rgba(255,255,255,0.6);
		margin-bottom: 10px;
	}

	/* Attendance circle */
	.attendance-circle {
		position: relative;
		width: 160px;
		height: 160px;
	}

		.attendance-circle svg {
			transform: rotate(-90deg);
		}

		.attendance-circle circle {
			fill: none;
			stroke-width: 12;
			stroke: #eee;
		}

		.attendance-circle .progress {
			stroke: #28c76f;
			stroke-dasharray: 440;
			stroke-dashoffset: 100; /* % control here */
			transition: stroke-dashoffset 1s ease;
		}

	/* Text center */
	.attendance-text {
		position: absolute;
		top: 50%;
		left: 50%;
		transform: translate(-50%, -50%);
		text-align: center;
	}

		.attendance-text h3 {
			margin: 0;
			font-weight: 700;
		}

		.attendance-text p {
			font-size: 13px;
			color: #777;
		}

		.employee-card {
	border-radius: 12px;
	overflow: hidden;
}

.employee-header {
	background: linear-gradient(135deg, #4f46e5, #06b6d4);
	padding: 14px 18px;
}



	:root {
		--brand: #2563eb;
		--border: #e5e7eb;
		--bg-soft: #f8fafc;
	}

	.modal-body {
		max-height: 70vh;
		overflow-y: auto;
		background: #f9fafb;
	}

	.form-section {
		background: #fff;
		border: 1px solid var(--border);
		border-radius: 10px;
		padding: 14px;
		margin-bottom: 14px;
	}

		.form-section h6 {
			font-size: 13px;
			font-weight: 700;
			color: #1e40af;
			margin-bottom: 10px;
			padding: 6px 10px;
			background: #eef2ff;
			border-left: 4px solid var(--brand);
			border-radius: 6px;
		}

	label {
		font-size: 12.5px;
		font-weight: 600;
		color: #374151;
	}

	.form-control, .form-select {
		height: 36px;
		font-size: 13px;
		border-radius: 6px;
		border: 1px solid var(--border);
	}

	.emp-image-card {
		background: linear-gradient(180deg,#eef2ff,#ffffff);
		border: 1px solid var(--border);
		border-radius: 14px;
		padding: 18px;
		text-align: center;
	}

		.emp-image-card img {
			width: 140px;
			height: 140px;
			border-radius: 50%;
			border: 4px solid #dbeafe;
			object-fit: cover;
			background: #fff;
			margin-bottom: 10px;
		}

	.modal-footer {
		background: #f8fafc;
		border-top: 1px solid var(--border);
		padding: 14px 20px;
	}

</style>
<!-- PAGE TITLE + BREADCRUMB -->
<div class="d-md-flex d-block align-items-center justify-content-between page-breadcrumb mb-3">
	<div>
		<h2 class="mb-1">Attendance Management System - Dashboard</h2>
	</div>
</div>

<!-- WELCOME CARD -->
<div class="card border-0 mb-3">
	<div class="card-body d-flex align-items-center justify-content-between flex-wrap">
		<div class="d-flex align-items-center">
			
			@{
				var userImage = User.FindFirst("UserImage")?.Value;
				var imagePath = string.IsNullOrWhiteSpace(userImage)
				? Url.Content("~/assets/img/profiles.JPG")
				: Url.Content("~/uploads/employee/" + userImage);
			}
.
			<span class="avatar avatar-xl">
				<img src="@imagePath" class="rounded-circle" />
			</span>


			<div class="ms-3">
				<h3 class="mb-1">
					Welcome Back, @User.Identity.Name
				</h3>

				<p class="mb-0">
					 Here is todays attendance record
				</p>
			</div>
		</div>

		<div>
			<button class="btn btn-secondary me-2" data-bs-toggle="modal"
					data-bs-target="#empModal"
					onclick="clearForm()">
				Add Employee
			</button>



			<a asp-controller="Home"
			   asp-action="AddHolidays"
			   class="btn btn-primary">
				<i class="fas fa-plus-circle me-1"></i> Add Holiday
			</a>

		</div>
	</div>
</div>

<!-- DASHBOARD CARDS -->
<div class="row g-3 mb-3">

	<div class="col-xl-3 col-md-6">
		<div class="card glass-card">
			<div class="card-body">
				<span class="avatar bg-primary mb-2">
					<i class="ti ti-users"></i>
				</span>
				<h6>Total Registered Employees</h6>  
				<h3>@ViewBag.TotalR_E</h3>
			</div>
		</div>
	</div>

	<div class="col-xl-3 col-md-6">
		<div class="card glass-card">
			<div class="card-body">
				<span class="avatar bg-success mb-2">
					<i class="ti ti-calendar"></i>
				</span>
				<h6>Total Active Employee</h6>
				<h3>@ViewBag.ActiveE</h3>
			</div>
		</div>
	</div>

	<div class="col-xl-3 col-md-6">
		<div class="card glass-card">
			<div class="card-body">
				<span class="avatar bg-warning mb-2">
					<i class="fa-solid fa-clipboard-user"></i>
				</span>
				<h6>Today's Attendance</h6>
				<h3>90/120</h3>
			</div>
		</div>
	</div>

	<div class="col-xl-3 col-md-6">
		<div class="card glass-card">
			<div class="card-body">
				<span class="avatar bg-danger mb-2">
					<i class="fa-solid fa-mug-hot"></i>
				</span>
				<h6>Total Holidays</h6>
				<h3>@ViewBag.TotalHolidays</h3>
			</div>
		</div>
	</div>

</div>


	<!-- BIRTHDAYS -->
	<div class="row g-3 mb-4">

		<!-- ATTENDANCE GRAPH -->
		<div class="col-xl-6 col-md-12">
			<div class="card glass-card h-100 text-center">
				<div class="card-header bg-transparent border-0">
					<h5 class="mb-0">Attendance Overview</h5>
				</div>

				<div class="card-body d-flex align-items-center justify-content-center">
					<div class="attendance-circle">
						<svg width="160" height="160">
							<circle cx="80" cy="80" r="70"></circle>
							<circle cx="80" cy="80" r="70" class="progress"></circle>
						</svg>
						<div class="attendance-text">
							<h3>78%</h3>
							<p>Present</p>
						</div>
					</div>
				</div>
			</div>
		</div>

	<!-- BIRTHDAYS -->
	<div class="col-xl-6 col-md-12">
		<div class="card glass-card h-100">
			<div class="card-header bg-transparent border-0 d-flex justify-content-between">
				<h5 class="mb-0">🎂 Upcoming Birthdays</h5>
				<a class="btn btn-light btn-sm"></a>
				<a asp-controller="Home" asp-action="EmployeeList" class="btn btn-light btn-sm">View All</a>
			</div>

			<div class="card-body">

				@if (ViewBag.BirthdayList != null && ViewBag.BirthdayList.Count > 0)
				{
					foreach (var emp in ViewBag.BirthdayList)
					{
						<div class="birthday-item row align-items-center mb-2">
							<div class="col-4">
								@emp.Name
							</div>

							<div class="col-3 text-muted">
								@{
									DateTime dob;
									if (DateTime.TryParse(emp.DOB?.ToString(), out dob))
									{
										@dob.ToString("dd/MM/yyyy")
									}
									else
									{
										<span>-</span>
									}
								}
							</div>


							<div class="col-3">
								@emp.PhoneNo
							</div>
							<div class="col-2 text-end">
								<button class="btn btn-secondary btn-xs">Send</button>
							</div>
						</div>

					}
				}
				else
				{
					<p class="text-muted">No upcoming birthdays</p>
				}

			</div>
		</div>
	</div>
</div>

<!-- RECENT ACTIVITIES + BIRTHDAYS -->
<div class="row g-3">
	<div class="card shadow-sm border-0 employee-card">

		<div class="card-header employee-header d-flex align-items-center justify-content-between">
			<h4 class="mb-0 text-primary">
				<i class="ti ti-users me-1"></i> Active Employee List
			</h4>

			<div class="d-flex align-items-center gap-2 filter-area">
				<select id="designationFilter" class="form-select filter-select">
					<option value="">All Designations</option>
					@foreach (var d in (List<SelectListItem>)ViewBag.DesignationList)
					{
						<option value="@d.Value">@d.Text</option>
					}
				</select>

				<select id="statusFilter" class="form-select filter-select-sm">
					<option value="">All</option>
					<option value="Active">Active</option>
					<option value="Inactive">Inactive</option>
				</select>
			</div>
		</div>

		<div class="card-body p-0">
			<div class="table-responsive">
				<table class="table table-hover align-middle mb-0 employee-table">

					<thead>
						<tr>
							<th>Emp ID</th>
							<th>Name</th>
							<th>Email</th>
							<th>Phone</th>
							<th>Department</th>
							<th>Joining Date</th>
							<th>Address</th>
							@* <th>Action</th> *@
						</tr>
					</thead>

					<!-- ✅ ONLY PARTIAL CALL HERE -->
					<tbody id="employeeTableBody">
						@await Html.PartialAsync("_EmployeeDashboardRows", Model)
					</tbody>

				</table>
			</div>
		</div>

	</div>
</div>




 
<div class="modal fade" id="add_holiday" tabindex="-1" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered modal-md">
		<div class="modal-content glass-modal">

			<div class="modal-header">
				<h5 class="modal-title">Add Holiday</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>

			<form method="post" asp-action="AddHoliday" asp-controller="Home">
				<div class="modal-body">

					<div class="mb-3">
						<label class="form-label">Title</label>
						<input name="Title" class="form-control" required />
					</div>

					<div class="mb-3">
						<label class="form-label">Date</label>
						<input type="date" name="HolidayDate" class="form-control datetimepicker" />
					</div>

					<div class="mb-3">
						<label class="form-label">Description</label>
						<textarea name="Description" class="form-control"></textarea>
					</div>

					<div class="mb-3">
						<label class="form-label">Status</label>
						<select name="Status" class="form-select">
							<option value="Active">Active</option>
							<option value="Inactive">Inactive</option>
						</select>
					</div>

				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">Save</button>
				</div>
			</form>

		</div>
	</div>
</div>



<div class="modal fade"
	 id="empModal"
	 data-bs-backdrop="static"
	 data-bs-keyboard="false">
	<div class="modal-dialog modal-xl modal-dialog-centered">
		<div class="modal-content">

			<form asp-action="SaveEmployee" method="post" enctype="multipart/form-data">

				<input type="hidden" name="Emp_Id" id="Emp_Id" />
				<input type="hidden" name="Emp_Img" id="Emp_Img" />

				<div class="modal-header">
					<h5 class="modal-title">Add Employee</h5>
					<button class="btn-close" data-bs-dismiss="modal"></button>
				</div>

				<div class="modal-body">
					<div class="row">

						<!-- IMAGE -->
						<div class="col-md-4">
							<div class="emp-image-card">
								<img id="imgPreview"
									 src="/assets/img/user-placeholder.png" />
								<input type="file"
									   class="form-control"
									   name="EmpImage"
									   onchange="previewImage(this)" />

								<div class="mt-3 text-start" style="font-size:13px">
									<div class="d-flex justify-content-between">
										<span class="fw-semibold">Module</span>
										<span>Employee</span>
									</div>
									<div class="d-flex justify-content-between">
										<span class="fw-semibold">Access</span>
										<span class="badge bg-success">Enabled</span>
									</div>
								</div>
							</div>
						</div>

						<!-- FORM -->
						<div class="col-md-8">

							<div class="form-section">
								<h6>Basic Information</h6>
								<div class="row">
									<div class="col-md-6 mb-2">
										<label>Full Name</label>
										<input class="form-control" name="Name" id="Name" />
									</div>
									<div class="col-md-3 mb-2">
										<label>DOB</label>
										<input type="date" class="form-control" name="Dob" id="Dob" />
									</div>
									<div class="col-md-3 mb-2">
										<label>Joining Date</label>
										<input type="date" class="form-control" name="JoiningDate" id="JoiningDate" />
									</div>
								</div>
							</div>

							<div class="form-section">
								<h6>Work Details</h6>
								<div class="row">
									<div class="col-md-4 mb-2">
										<label>Department</label>
										<select class="form-select" name="DepartmentId" id="DepartmentId">
											@foreach (var d in (List<SelectListItem>)ViewBag.DepartmentList)
											{
												<option value="@d.Value">@d.Text</option>
											}
										</select>
									</div>

									<div class="col-md-4 mb-2">
										<label>Designation</label>
										<select class="form-select" name="DesignationId" id="DesignationId">
											@foreach (var d in (List<SelectListItem>)ViewBag.DesignationList)
											{
												<option value="@d.Value">@d.Text</option>
											}
										</select>
									</div>

									<div class="col-md-4 mb-2">
										<label>Shift</label>
										<select class="form-select" name="ShiftId" id="ShiftId">
											@foreach (var d in (List<SelectListItem>)ViewBag.Shiftlistt)
											{
												<option value="@d.Value">@d.Text</option>
											}
										</select>
									</div>

								</div>
							</div>

							<div class="form-section">
								<h6>Contact & Login</h6>
								<div class="row">
									<div class="col-md-4 mb-2">
										<label>Email</label>
										<input class="form-control" name="EmailId" id="EmailId" />
									</div>
									<div class="col-md-4 mb-2">
										<label>Phone</label>
										<input class="form-control" name="PhoneNo" id="PhoneNo" />
									</div>
									<div class="col-md-4 mb-2">
										<label>Salary</label>
										<input class="form-control" name="Salary" id="Salary" />
									</div>
								</div>

								<div class="row">
									<div class="col-md-4 mb-2">
										<label>User Name</label>
										<input class="form-control" name="UserName" id="UserName" />
									</div>
									<div class="col-md-4 mb-2">
										<label>Password</label>
										<input type="password" class="form-control" name="Password" id="Password" />
									</div>
									<div class="col-md-4 mb-2">
										<label>Status</label>
										<select class="form-select" name="Status" id="Status">
											<option>Active</option>
											<option>Inactive</option>
										</select>
									</div>
								</div>

								<label>Address</label>
								<textarea class="form-control" rows="2" name="Address" id="Address"></textarea>
							</div>

						</div>
					</div>
				</div>

				<div class="modal-footer">
					<button class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
					<button class="btn btn-primary">Save</button>
				</div>

			</form>
		</div>
	</div>
</div>


 

@section Scripts {

	<script>
		function previewImage(input) {
			if (input.files && input.files[0]) {
				const r = new FileReader();
				r.onload = e => imgPreview.src = e.target.result;
				r.readAsDataURL(input.files[0]);
			}
		}

		const empModalEl = document.getElementById('empModal');
		empModalEl.addEventListener('hidden.bs.modal', () => {
			document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
			document.body.classList.remove('modal-open');
			document.body.style = '';
		});
	</script>
	<script>

		function previewImage(input) {
			if (input.files && input.files[0]) {
				const reader = new FileReader();
				reader.onload = e => imgPreview.src = e.target.result;
				reader.readAsDataURL(input.files[0]);
			}
		}
	</script>

	<script>
		function loadEmployees() {
			let designationId = $("#designationFilter").val();
			let status = $("#statusFilter").val();

			$.get("/Home/FilterEmployeeList", {
				designationId: designationId,
				status: status
			}, function (html) {
				$("#employeeTableBody").html(html);
			});
		}

		$("#designationFilter, #statusFilter").on("change", loadEmployees);
	</script>

}
